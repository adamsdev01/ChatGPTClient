@page "/"

<PageTitle>Index</PageTitle>
<h1>Finish the Sentence...</h1>
<input class="form-control" @bind="prompt" type="text" />
<br />
<button class="btn btn-primary" @onclick="CallService">
    Call The Service
</button>
<br />
<br />
<h4>Response:</h4>
<br />
<p>@response</p>

@code{
    string Organization = "";
    string ApiKey = "";
    string prompt = "Once upon a time";
    string response = "";

    protected override void OnInitialized()
    {
        Organization = _configuration["OpenAIServiceOptions:Organization"] ?? "";
        ApiKey = _configuration["OpenAIServiceOptions:ApiKey"] ?? "";
    }

    public async Task CallService()
    {
        // Gets OrganizationID and APIKey from secrets
        var openAiService = new OpenAIService(new OpenAiOptions()
        {
            ApiKey = ApiKey,
            Organization = Organization
        });

        // Pass the prompt to the service
        var completionResult = await openAiService.Completions.CreateCompletion(new CompletionCreateRequest()
        {
            Prompt = prompt,
            MaxTokens = 5 // 5 words
        },
        Models.Davinci);

        // Return result or error message
        if (completionResult.Successful)
        {
            response = completionResult.Choices.FirstOrDefault()?.Text ?? "";
        }
        else
        {
            if(completionResult.Error == null)
            {
                response = "Unknow Error";
            }

            response = $"{completionResult.Error?.Code}: {completionResult.Error?.Message}";
        }
    }
}